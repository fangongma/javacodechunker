{
  "language" : "java",
  "filePath" : "D:\\Learning\\Git\\sftp\\src\\main\\java\\jp\\co\\jri\\epix\\sftp\\config\\SftpConfig.java",
  "chunkId" : "jp.co.jri.epix.sftp.config.SftpConfig",
  "kind" : "METHOD",
  "name" : "sftpRetryAdvice",
  "parent" : {
    "namespace" : "jp.co.jri.epix.sftp.config",
    "classes" : [ ]
  },
  "signature" : "public  RequestHandlerRetryAdvice sftpRetryAdvice()",
  "location" : {
    "startLine" : 212,
    "endLine" : 237
  },
  "imports" : [ "com.jcraft.jsch.ChannelSftp", "jp.co.jri.epix.sftp.mapper.ApiAccessMapper", "jp.co.jri.epix.sftp.model.ApiAccess", "jp.co.jri.epix.sftp.service.SftpService", "org.apache.logging.log4j.LogManager", "org.apache.logging.log4j.Logger", "org.springframework.beans.factory.annotation.Value", "org.springframework.context.annotation.Bean", "org.springframework.context.annotation.Configuration", "org.springframework.expression.common.LiteralExpression", "org.springframework.integration.annotation.IntegrationComponentScan", "org.springframework.integration.channel.DirectChannel", "org.springframework.integration.channel.NullChannel", "org.springframework.integration.config.EnableIntegration", "org.springframework.integration.dsl.IntegrationFlow", "org.springframework.integration.dsl.IntegrationFlows", "org.springframework.integration.file.FileHeaders", "org.springframework.integration.file.remote.RemoteFileTemplate", "org.springframework.integration.file.remote.session.CachingSessionFactory", "org.springframework.integration.handler.advice.ErrorMessageSendingRecoverer", "org.springframework.integration.handler.advice.RequestHandlerRetryAdvice", "org.springframework.integration.sftp.outbound.SftpMessageHandler", "org.springframework.integration.sftp.session.DefaultSftpSessionFactory", "org.springframework.messaging.Message", "org.springframework.messaging.MessageChannel", "org.springframework.messaging.MessageHandler", "org.springframework.retry.backoff.FixedBackOffPolicy", "org.springframework.retry.interceptor.MethodInvocationRecoverer", "org.springframework.retry.interceptor.RetryInterceptorBuilder", "org.springframework.retry.interceptor.RetryOperationsInterceptor", "org.springframework.retry.policy.SimpleRetryPolicy", "org.springframework.retry.support.RetryTemplate" ],
  "modifiers" : [ "public " ],
  "symbols" : {
    "classes" : [ ],
    "methods" : [ ],
    "fields" : [ ],
    "variables" : [ ]
  },
  "code" : "@Bean\r\npublic RequestHandlerRetryAdvice sftpRetryAdvice() {\r\n    RequestHandlerRetryAdvice advice = new RequestHandlerRetryAdvice();\r\n    RetryTemplate retryTemplate = new RetryTemplate();\r\n    SimpleRetryPolicy retryPolicy = new SimpleRetryPolicy();\r\n    retryPolicy.setMaxAttempts(maxAttempts);\r\n    FixedBackOffPolicy backOffPolicy = new FixedBackOffPolicy();\r\n    // in ms\r\n    backOffPolicy.setBackOffPeriod(retryDelay);\r\n    retryTemplate.setRetryPolicy(retryPolicy);\r\n    retryTemplate.setBackOffPolicy(backOffPolicy);\r\n    advice.setRetryTemplate(retryTemplate);\r\n    // Optional: log or handle final failure\r\n    advice.setRecoveryCallback(context -> {\r\n        Message<?> failedMessage = (Message<?>) context.getAttribute(\"message\");\r\n        System.err.println(\"SFTP upload permanently failed: \" + failedMessage);\r\n        return null;\r\n    });\r\n    return advice;\r\n}",
  "notes" : { }
}